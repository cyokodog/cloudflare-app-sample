## Backend API

æœ¬ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã¯ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®è¿½åŠ ç­‰ã‚’è¡Œã† API ã‚’æä¾›ã—ã¾ã™ã€‚

API ã®èµ·å‹•ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§è¡Œã†ã«ã¯`dev --persist-to`ã‚’æ¬¡ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚

```sh
wrangler dev --persist-to ../../.wrangler/state --port 8686
```

ã“ã‚Œã§ API ã‚’å‘¼ã³ã ã›ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€curl ã§ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã™ã€‚

```sh
curl http://localhost:8686/v1/tasks/create \
  -X POST \
  -d '{"taskName": "é‡èœã‚’è²·ã†"}'

curl http://localhost:8686/v1/tasks/create \
  -X POST \
  -d '{"taskName": "è‚‰ã‚’è²·ã†", "taskDescription": "ç‰›è‚‰ã¨è±šè‚‰ã‚’è²·ã†"}'
```

`d1 execute`ã§ SQL ã‚’å®Ÿè¡Œã—ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```sh
wrangler d1 execute app-sample-db  --local --persist-to ../../.wrangler/state --command "SELECT * FROM tasks"


 â›…ï¸ wrangler 3.28.2 (update available 3.63.2)
-------------------------------------------------------
ğŸŒ€ Mapping SQL input into an array of statements
ğŸŒ€ Executing on local database app-sample-db (38ba3ddb-597f-4ca1-8040-d3bde4063024) from ../../.wrangler/state/v3/d1:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ created_at    â”‚ updated_at    â”‚ id                         â”‚ task_name â”‚ task_description â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1712735344259 â”‚ 1712735344259 â”‚ 01HV3FPNM3MVBWA9SXJ6F6J0DZ â”‚ Task Name â”‚ Task Description â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1712736965863 â”‚ 1712736965863 â”‚ 01HV3H85755K4EEGBYZ123R0A4 â”‚ é‡èœã‚’è²·ã†     â”‚                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1712737146738 â”‚ 1712737146738 â”‚ 01HV3HDNVHNGK1J036GSYF4MXF â”‚ è‚‰ã‚’è²·ã†      â”‚ ç‰›è‚‰ã¨è±šè‚‰ã‚’è²·ã†         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Backend API ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

`wrangler deploy`ã‚³ãƒãƒ³ãƒ‰ã§ã€Backend API ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚

```
wrangler deploy

 â›…ï¸ wrangler 3.28.2 (update available 3.63.2)
-------------------------------------------------------
Your worker has access to the following bindings:
- D1 Databases:
  - DB: app-sample-db (38ba3ddb-597f-4ca1-8040-d3bde4063024), Preview: (38ba3ddb-597f-4ca1-8040-d3bde4063024)
Total Upload: 243.92 KiB / gzip: 46.23 KiB
Uploaded app-sample-backend-api (2.23 sec)
Published app-sample-backend-api (3.92 sec)
  https://app-sample-backend-api.cyokodog.workers.dev
Current Deployment ID: 8ca8b41e-e1f7-4b2e-9085-d6bad8485b92
```

ä¸Šè¨˜ã‚’è¦‹ã‚‹ã¨ã€`https://app-sample-backend-api.cyokodog.workers.dev`ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚Cloudflare ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã‚‚æ¬¡ã®ã‚ˆã†ã«ç¢ºèªã§ãã¾ã™ã€‚

![alt text](image.png)

å…ˆã»ã©ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§è©¦ã—ãŸã‚ˆã†ã«ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸ Backend API ã‚’ä½¿ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦ã¿ã¾ã™ã€‚

```sh
curl https://app-sample-backend-api.cyokodog.workers.dev/v1/tasks/create \
 -X POST \
 -d '{"taskName": "é‡èœã‚’è²·ã†"}'
```

SQL ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒç™»éŒ²ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```sh
wrangler d1 execute app-sample-db  --command "SELECT * FROM tasks"

 â›…ï¸ wrangler 3.28.2 (update available 3.63.2)
-------------------------------------------------------
ğŸŒ€ Mapping SQL input into an array of statements
ğŸŒ€ Parsing 1 statements
ğŸŒ€ Executing on remote database app-sample-db (38ba3ddb-597f-4ca1-8040-d3bde4063024):
ğŸŒ€ To execute on your local development database, pass the --local flag to 'wrangler d1 execute'
ğŸš£ Executed 1 commands in 0.1908ms
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ created_at    â”‚ updated_at    â”‚ id                         â”‚ task_name â”‚ task_description â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1720596600416 â”‚ 1720596600416 â”‚ 01J2DRS5K0J4GBWD5FDRHD7N18 â”‚ é‡èœã‚’è²·ã†  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Cloudflare ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã‚‚ã€ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒç™»éŒ²ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚

![alt text](image-1.png)
